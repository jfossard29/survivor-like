[gd_scene load_steps=21 format=4 uid="uid://1hoxtt5rrj3g"]

[ext_resource type="Shader" uid="uid://p6i28ung6ymp" path="res://shaders/sky.gdshader" id="1_kte4k"]
[ext_resource type="Script" uid="uid://d3b8ydmcddf0q" path="res://script/racine.gd" id="1_n7u81"]
[ext_resource type="PackedScene" uid="uid://cgbo35opsgy86" path="res://scenes/mechant.tscn" id="2_euwd0"]
[ext_resource type="PackedScene" uid="uid://b1stvgy2g2801" path="res://scenes/Boss.tscn" id="3_euwd0"]
[ext_resource type="PackedScene" uid="uid://bcl5krgds1wpe" path="res://scenes/Joueur.tscn" id="4_kyype"]
[ext_resource type="PackedScene" uid="uid://bk7dangodqgts" path="res://scenes/SpawnRoot.tscn" id="5_kyype"]
[ext_resource type="Script" uid="uid://bj34ar46op5rx" path="res://script/Quadrilatere.gd" id="12_ds77h"]
[ext_resource type="Shader" uid="uid://dta3l04x00wf6" path="res://shaders/sun.gdshader" id="13_mgd15"]
[ext_resource type="PackedScene" uid="uid://dgj6vfkt8w7oj" path="res://scenes/boss_health_ui.tscn" id="15_euwd0"]
[ext_resource type="PackedScene" uid="uid://b64at4io6wnlg" path="res://scenes/Pause.tscn" id="15_n7u81"]
[ext_resource type="PackedScene" uid="uid://dhe2pasw5lmqd" path="res://scenes/timer.tscn" id="17_kyype"]
[ext_resource type="Script" uid="uid://bh7e0qnmfc1tu" path="res://script/timer_ui.gd" id="18_4s1pf"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_sgosv"]
shader = ExtResource("1_kte4k")
shader_parameter/sky_color = Color(0.1, 0, 0.2, 1)
shader_parameter/grid_color = Color(0.827451, 0.34117648, 1, 1)
shader_parameter/horizon_color = Color(0.1, 0.1, 0.15, 1)
shader_parameter/mountain_color = Color(0.15, 0.15, 0.25, 1)
shader_parameter/mountain_outline = Color(1, 0.2, 0.8, 1)
shader_parameter/grid_size = 2.0
shader_parameter/line_width = 0.02
shader_parameter/intersection_glow = 0.5
shader_parameter/horizon_height = -0.10899995767750004
shader_parameter/grid_fade_distance = 20.0
shader_parameter/mountain_height = 0.15
shader_parameter/mountain_scale = 2.0
shader_parameter/outline_width = 0.05000000074506

[sub_resource type="Sky" id="Sky_6mm8b"]
sky_material = SubResource("ShaderMaterial_sgosv")

[sub_resource type="Environment" id="Environment_6qlrk"]
background_mode = 2
sky = SubResource("Sky_6mm8b")
glow_enabled = true

[sub_resource type="Shader" id="Shader_lnpbn"]
code = "
shader_type spatial;
render_mode blend_add, depth_draw_opaque, cull_back, unshaded;

uniform vec4 line_color : source_color = vec4(0.0, 1.0, 1.0, 1.0);
uniform float line_speed : hint_range(0.0, 5.0) = 1.0;
uniform float line_width : hint_range(0.01, 0.5) = 0.05;
uniform float line_spacing : hint_range(0.1, 1.0) = 0.2;
uniform float emission_strength : hint_range(0.0, 10.0) = 2.0;

void fragment() {
	// Inverser la direction : défilement du haut (1) vers la base (0)
	float scroll = fract(UV.y - TIME * line_speed);
	
	// Créer des lignes répétées
	float pattern = fract(scroll / line_spacing);
	
	// Déterminer si on est sur une ligne (contrôle de la taille)
	float line = smoothstep(line_width, 0.0, pattern) + smoothstep(1.0 - line_width, 1.0, pattern);
	
	// Effet de fade-out en arrivant au bout (UV.y proche de 0.0 maintenant)
	float fade = smoothstep(0.0, 0.15, UV.y);
	
	// Combiner la ligne avec le fade
	float final_line = line * fade;
	
	// Appliquer la couleur avec émission
	ALBEDO = line_color.rgb * emission_strength;
	EMISSION = line_color.rgb * emission_strength * final_line;
	ALPHA = final_line * line_color.a;
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_kte4k"]
render_priority = 0
shader = SubResource("Shader_lnpbn")
shader_parameter/line_color = Color(0.78941506, 0, 0.33577523, 0.42745098)
shader_parameter/line_speed = 0.1
shader_parameter/line_width = 0.7
shader_parameter/line_spacing = 0.1
shader_parameter/emission_strength = 1.0

[sub_resource type="ArrayMesh" id="ArrayMesh_v17pu"]
_surfaces = [{
"aabb": AABB(-150, 0, -300, 300, 1e-05, 600),
"attribute_data": PackedByteArray("AAAAAAAAAAAAAIA/AAAAAAAAgD8AAIA/AAAAAAAAAAAAAIA/AACAPwAAAAAAAIA/"),
"format": 34359738391,
"primitive": 3,
"uv_scale": Vector4(0, 0, 0, 0),
"vertex_count": 6,
"vertex_data": PackedByteArray("AAAWwwAAAAAAAJbDAAAWQwAAAAAAAJbDAACWQgAAAAAAAJZDAAAWwwAAAAAAAJbDAACWQgAAAAAAAJZDAACWwgAAAAAAAJZD/3///wAA/7//f///AAD/v/9///8AAP+//3///wAA/7//f///AAD/v/9///8AAP+/")
}]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_cxcjd"]
render_priority = 0
shader = ExtResource("13_mgd15")
shader_parameter/color_top = Color(1, 0.5, 0, 1)
shader_parameter/color_bottom = Color(1, 0, 0.5, 1)
shader_parameter/line_speed = 0.0310000014725
shader_parameter/line_width = 0.5
shader_parameter/line_spacing = 0.10000000149012
shader_parameter/emission_strength = 1.286000061085

[sub_resource type="SphereMesh" id="SphereMesh_pfvfn"]
material = SubResource("ShaderMaterial_cxcjd")
radius = 256.0
height = 504.0

[node name="Racine" type="Node3D"]
script = ExtResource("1_n7u81")
pnj_scene = ExtResource("2_euwd0")
boss_scene = ExtResource("3_euwd0")
player_scene = ExtResource("4_kyype")
min_spawn_distance = 15.0

[node name="Joueur" parent="." instance=ExtResource("4_kyype")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 21.64131, 0)

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_6qlrk")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.9945165, 0.10458055, 0, -0.10458055, 0.9945165, -0.10938668, 24.840767, 301.89688)
light_color = Color(0.9116014, 0.48098278, 0.4881596, 1)

[node name="Map" parent="." instance=ExtResource("5_kyype")]
map_size = 300
min_platform_blocs = 3
ground_height = 0.0
pylone_path = "uid://bl76k8qf7c418"
pylone_shader_path = "uid://g3uovj5kqbhb"
pylone_script_path = "uid://bbkiswqwrl6a6"

[node name="performance" type="Node3D" parent="."]

[node name="Sunset" type="Node3D" parent="."]

[node name="MeshInstance3D" type="MeshInstance3D" parent="Sunset"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -42.707893, 449.0048)
material_override = SubResource("ShaderMaterial_kte4k")
mesh = SubResource("ArrayMesh_v17pu")
script = ExtResource("12_ds77h")
base_width = 300.0
top_ratio = 0.5
depth = 600.0
line_color = Color(0.78941506, 0, 0.33577523, 0.42745098)
line_speed = 0.1
line_width = 0.7
line_spacing = 0.1
emission_strength = 1.0

[node name="MeshInstance3D2" type="MeshInstance3D" parent="Sunset"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.6348572, -95.474396, 1899.2933)
mesh = SubResource("SphereMesh_pfvfn")

[node name="PauseMenu" parent="." instance=ExtResource("15_n7u81")]

[node name="Timer" parent="." instance=ExtResource("17_kyype")]
script = ExtResource("18_4s1pf")

[node name="BossHealthUI" parent="." instance=ExtResource("15_euwd0")]
