[gd_scene load_steps=43 format=4 uid="uid://1hoxtt5rrj3g"]

[ext_resource type="Shader" uid="uid://p6i28ung6ymp" path="res://shaders/sky.gdshader" id="1_kte4k"]
[ext_resource type="Script" uid="uid://d3b8ydmcddf0q" path="res://script/racine.gd" id="1_n7u81"]
[ext_resource type="PackedScene" uid="uid://cgbo35opsgy86" path="res://scenes/mechant.tscn" id="2_euwd0"]
[ext_resource type="PackedScene" uid="uid://b1stvgy2g2801" path="res://scenes/Boss.tscn" id="3_euwd0"]
[ext_resource type="PackedScene" uid="uid://bcl5krgds1wpe" path="res://scenes/Joueur.tscn" id="4_kyype"]
[ext_resource type="PackedScene" uid="uid://bk7dangodqgts" path="res://scenes/SpawnRoot.tscn" id="5_kyype"]
[ext_resource type="Script" uid="uid://bbkiswqwrl6a6" path="res://script/pylone_charge.gd" id="7_n7u81"]
[ext_resource type="Shader" uid="uid://g3uovj5kqbhb" path="res://shaders/pylone.gdshader" id="8_euwd0"]
[ext_resource type="ArrayMesh" uid="uid://bl76k8qf7c418" path="res://assets/pylone.vox" id="9_kyype"]
[ext_resource type="Script" uid="uid://0mf78caqltxw" path="res://script/map/test_fesceau.gd" id="10_euwd0"]
[ext_resource type="Script" uid="uid://bj34ar46op5rx" path="res://script/Quadrilatere.gd" id="12_ds77h"]
[ext_resource type="Shader" uid="uid://dta3l04x00wf6" path="res://shaders/sun.gdshader" id="13_mgd15"]
[ext_resource type="PackedScene" uid="uid://dgj6vfkt8w7oj" path="res://scenes/boss_health_ui.tscn" id="15_euwd0"]
[ext_resource type="PackedScene" uid="uid://b64at4io6wnlg" path="res://scenes/Pause.tscn" id="15_n7u81"]
[ext_resource type="PackedScene" uid="uid://dhe2pasw5lmqd" path="res://scenes/timer.tscn" id="17_kyype"]
[ext_resource type="Script" uid="uid://bh7e0qnmfc1tu" path="res://script/timer_ui.gd" id="18_4s1pf"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_sgosv"]
shader = ExtResource("1_kte4k")
shader_parameter/sky_color = Color(0.1, 0, 0.2, 1)
shader_parameter/grid_color = Color(0.827451, 0.34117648, 1, 1)
shader_parameter/horizon_color = Color(0.1, 0.1, 0.15, 1)
shader_parameter/mountain_color = Color(0.15, 0.15, 0.25, 1)
shader_parameter/mountain_outline = Color(1, 0.2, 0.8, 1)
shader_parameter/grid_size = 2.0
shader_parameter/line_width = 0.02
shader_parameter/intersection_glow = 0.5
shader_parameter/horizon_height = -0.10899995767750004
shader_parameter/grid_fade_distance = 20.0
shader_parameter/mountain_height = 0.15
shader_parameter/mountain_scale = 2.0
shader_parameter/outline_width = 0.05000000074506

[sub_resource type="Sky" id="Sky_n7u81"]
sky_material = SubResource("ShaderMaterial_sgosv")

[sub_resource type="Environment" id="Environment_6qlrk"]
background_mode = 2
sky = SubResource("Sky_n7u81")
glow_enabled = true

[sub_resource type="ShaderMaterial" id="ShaderMaterial_kyype"]
render_priority = 0
shader = ExtResource("8_euwd0")
shader_parameter/brightness_threshold = 0.9
shader_parameter/neon_color = Color(1, 0, 0, 0)
shader_parameter/emission_strength = 10.0
shader_parameter/tint_with_original = true

[sub_resource type="BoxShape3D" id="BoxShape3D_4s1pf"]
size = Vector3(8, 26, 8)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_6wm8b"]
render_priority = 0
shader = ExtResource("8_euwd0")
shader_parameter/brightness_threshold = 0.9
shader_parameter/neon_color = Color(1, 0, 0, 0)
shader_parameter/emission_strength = 10.0
shader_parameter/tint_with_original = true

[sub_resource type="BoxShape3D" id="BoxShape3D_ibfkh"]
size = Vector3(8, 26, 8)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_65hki"]
render_priority = 0
shader = ExtResource("8_euwd0")
shader_parameter/brightness_threshold = 0.9
shader_parameter/neon_color = Color(1, 0, 0, 0)
shader_parameter/emission_strength = 10.0
shader_parameter/tint_with_original = true

[sub_resource type="BoxShape3D" id="BoxShape3D_sl8nf"]
size = Vector3(8, 26, 8)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_idhvh"]
render_priority = 0
shader = ExtResource("8_euwd0")
shader_parameter/brightness_threshold = 0.9
shader_parameter/neon_color = Color(1, 0, 0, 0)
shader_parameter/emission_strength = 10.0
shader_parameter/tint_with_original = true

[sub_resource type="BoxShape3D" id="BoxShape3D_ds77h"]
size = Vector3(8, 26, 8)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_mgd15"]
render_priority = 0
shader = ExtResource("8_euwd0")
shader_parameter/brightness_threshold = 0.9
shader_parameter/neon_color = Color(1, 0, 0, 0)
shader_parameter/emission_strength = 10.0
shader_parameter/tint_with_original = true

[sub_resource type="BoxShape3D" id="BoxShape3D_rujxr"]
size = Vector3(8, 26, 8)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_di5v4"]
render_priority = 0
shader = ExtResource("8_euwd0")
shader_parameter/brightness_threshold = 0.9
shader_parameter/neon_color = Color(1, 0, 0, 0)
shader_parameter/emission_strength = 10.0
shader_parameter/tint_with_original = true

[sub_resource type="BoxShape3D" id="BoxShape3D_arxee"]
size = Vector3(8, 26, 8)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_t65ry"]
render_priority = 0
shader = ExtResource("8_euwd0")
shader_parameter/brightness_threshold = 0.9
shader_parameter/neon_color = Color(1, 0, 0, 0)
shader_parameter/emission_strength = 10.0
shader_parameter/tint_with_original = true

[sub_resource type="BoxShape3D" id="BoxShape3D_wsll3"]
size = Vector3(8, 26, 8)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_a8smn"]
render_priority = 0
shader = ExtResource("8_euwd0")
shader_parameter/brightness_threshold = 0.9
shader_parameter/neon_color = Color(1, 0, 0, 0)
shader_parameter/emission_strength = 10.0
shader_parameter/tint_with_original = true

[sub_resource type="BoxShape3D" id="BoxShape3D_qcn36"]
size = Vector3(8, 26, 8)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ni871"]
render_priority = 0
shader = ExtResource("8_euwd0")
shader_parameter/brightness_threshold = 0.9
shader_parameter/neon_color = Color(1, 0, 0, 0)
shader_parameter/emission_strength = 10.0
shader_parameter/tint_with_original = true

[sub_resource type="BoxShape3D" id="BoxShape3D_8d6gy"]
size = Vector3(8, 26, 8)

[sub_resource type="Shader" id="Shader_awg2i"]
code = "
shader_type spatial;
render_mode blend_add, depth_draw_opaque, cull_back, unshaded;

uniform vec4 line_color : source_color = vec4(0.0, 1.0, 1.0, 1.0);
uniform float line_speed : hint_range(0.0, 5.0) = 1.0;
uniform float line_width : hint_range(0.01, 0.5) = 0.05;
uniform float line_spacing : hint_range(0.1, 1.0) = 0.2;
uniform float emission_strength : hint_range(0.0, 10.0) = 2.0;

void fragment() {
	// Inverser la direction : défilement du haut (1) vers la base (0)
	float scroll = fract(UV.y - TIME * line_speed);
	
	// Créer des lignes répétées
	float pattern = fract(scroll / line_spacing);
	
	// Déterminer si on est sur une ligne (contrôle de la taille)
	float line = smoothstep(line_width, 0.0, pattern) + smoothstep(1.0 - line_width, 1.0, pattern);
	
	// Effet de fade-out en arrivant au bout (UV.y proche de 0.0 maintenant)
	float fade = smoothstep(0.0, 0.15, UV.y);
	
	// Combiner la ligne avec le fade
	float final_line = line * fade;
	
	// Appliquer la couleur avec émission
	ALBEDO = line_color.rgb * emission_strength;
	EMISSION = line_color.rgb * emission_strength * final_line;
	ALPHA = final_line * line_color.a;
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_fgyje"]
render_priority = 0
shader = SubResource("Shader_awg2i")
shader_parameter/line_color = Color(0.78941506, 0, 0.33577523, 0.42745098)
shader_parameter/line_speed = 0.05
shader_parameter/line_width = 0.5
shader_parameter/line_spacing = 0.1
shader_parameter/emission_strength = 1.5

[sub_resource type="ArrayMesh" id="ArrayMesh_r87ru"]
_surfaces = [{
"aabb": AABB(-600, 0, -1200, 1200, 1e-05, 2400),
"attribute_data": PackedByteArray("AAAAAAAAAAAAAIA/AAAAAAAAgD8AAIA/AAAAAAAAAAAAAIA/AACAPwAAAAAAAIA/"),
"format": 34359738391,
"primitive": 3,
"uv_scale": Vector4(0, 0, 0, 0),
"vertex_count": 6,
"vertex_data": PackedByteArray("AAAWxAAAAAAAAJbEAAAWRAAAAAAAAJbEAACWQwAAAAAAAJZEAAAWxAAAAAAAAJbEAACWQwAAAAAAAJZEAACWwwAAAAAAAJZE/3///wAA/7//f///AAD/v/9///8AAP+//3///wAA/7//f///AAD/v/9///8AAP+/")
}]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_cxcjd"]
render_priority = 0
shader = ExtResource("13_mgd15")
shader_parameter/color_top = Color(1, 0.5, 0, 1)
shader_parameter/color_bottom = Color(1, 0, 0.5, 1)
shader_parameter/line_speed = 0.0310000014725
shader_parameter/line_width = 0.5
shader_parameter/line_spacing = 0.10000000149012

[sub_resource type="SphereMesh" id="SphereMesh_pfvfn"]
material = SubResource("ShaderMaterial_cxcjd")
radius = 512.0
height = 1008.0

[node name="Racine" type="Node3D"]
script = ExtResource("1_n7u81")
pnj_scene = ExtResource("2_euwd0")
boss_scene = ExtResource("3_euwd0")
player_scene = ExtResource("4_kyype")
min_spawn_distance = 15.0

[node name="Joueur" parent="." instance=ExtResource("4_kyype")]
transform = Transform3D(-0.9995798, 0, -0.028985813, 0, 1, 0, 0.028985813, 0, -0.9995798, 40.92035, 21.64131, 32.321846)

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_6qlrk")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.9999334, -0.0012064934, 0.011473112, -0.0012695245, 0.97696817, 0.21338111, -0.011466309, -0.2133815, 0.9769017, 0, 77.8699, 208.5287)
light_color = Color(0.5757481, 0.5672782, 1, 1)

[node name="Map" parent="." instance=ExtResource("5_kyype")]
map_size = 150
bloc_path = "uid://7eq667phpr05"
pylone_path = "uid://bl76k8qf7c418"
pylone_shader_path = "uid://g3uovj5kqbhb"
pylone_script_path = "uid://bbkiswqwrl6a6"
audio_wall_script_path = "uid://cne885366udw3"

[node name="GeneratedStaticBody" type="Node3D" parent="Map"]

[node name="Pilone_1" type="Node3D" parent="Map/GeneratedStaticBody"]
transform = Transform3D(0.25248256, 0, 0.43156987, 0, 0.5, 0, -0.43156987, 0, 0.25248256, 30, 30, 20)
script = ExtResource("7_n7u81")

[node name="PiloneMesh" type="MeshInstance3D" parent="Map/GeneratedStaticBody/Pilone_1"]
material_override = SubResource("ShaderMaterial_kyype")
mesh = ExtResource("9_kyype")

[node name="Pilone_1_Body" type="StaticBody3D" parent="Map/GeneratedStaticBody/Pilone_1"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 6.5, 0)
collision_layer = 2
collision_mask = 4

[node name="CollisionShape" type="CollisionShape3D" parent="Map/GeneratedStaticBody/Pilone_1/Pilone_1_Body"]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0, 0, 0)
shape = SubResource("BoxShape3D_4s1pf")

[node name="LightBeam" type="Node3D" parent="Map/GeneratedStaticBody/Pilone_1"]
script = ExtResource("10_euwd0")

[node name="Pilone_2" type="Node3D" parent="Map/GeneratedStaticBody"]
transform = Transform3D(-0.03140098, 0, -0.499013, 0, 0.5, 0, 0.499013, 0, -0.03140098, -40, 10, 60)
script = ExtResource("7_n7u81")

[node name="PiloneMesh" type="MeshInstance3D" parent="Map/GeneratedStaticBody/Pilone_2"]
material_override = SubResource("ShaderMaterial_6wm8b")
mesh = ExtResource("9_kyype")

[node name="Pilone_2_Body" type="StaticBody3D" parent="Map/GeneratedStaticBody/Pilone_2"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 6.5, 0)
collision_layer = 2
collision_mask = 4

[node name="CollisionShape" type="CollisionShape3D" parent="Map/GeneratedStaticBody/Pilone_2/Pilone_2_Body"]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0, 0, 0)
shape = SubResource("BoxShape3D_ibfkh")

[node name="LightBeam" type="Node3D" parent="Map/GeneratedStaticBody/Pilone_2"]
script = ExtResource("10_euwd0")

[node name="Pilone_3" type="Node3D" parent="Map/GeneratedStaticBody"]
transform = Transform3D(-0.20728956, 0, 0.45500663, 0, 0.5, 0, -0.45500663, 0, -0.20728956, -40, 10, 30)
script = ExtResource("7_n7u81")

[node name="PiloneMesh" type="MeshInstance3D" parent="Map/GeneratedStaticBody/Pilone_3"]
material_override = SubResource("ShaderMaterial_65hki")
mesh = ExtResource("9_kyype")

[node name="Pilone_3_Body" type="StaticBody3D" parent="Map/GeneratedStaticBody/Pilone_3"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 6.5, 0)
collision_layer = 2
collision_mask = 4

[node name="CollisionShape" type="CollisionShape3D" parent="Map/GeneratedStaticBody/Pilone_3/Pilone_3_Body"]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0, 0, 0)
shape = SubResource("BoxShape3D_sl8nf")

[node name="LightBeam" type="Node3D" parent="Map/GeneratedStaticBody/Pilone_3"]
script = ExtResource("10_euwd0")

[node name="Pilone_4" type="Node3D" parent="Map/GeneratedStaticBody"]
transform = Transform3D(-0.29941306, 0, -0.40043956, 0, 0.5, 0, 0.40043956, 0, -0.29941306, 30, 30, 10)
script = ExtResource("7_n7u81")

[node name="PiloneMesh" type="MeshInstance3D" parent="Map/GeneratedStaticBody/Pilone_4"]
material_override = SubResource("ShaderMaterial_idhvh")
mesh = ExtResource("9_kyype")

[node name="Pilone_4_Body" type="StaticBody3D" parent="Map/GeneratedStaticBody/Pilone_4"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 6.5, 0)
collision_layer = 2
collision_mask = 4

[node name="CollisionShape" type="CollisionShape3D" parent="Map/GeneratedStaticBody/Pilone_4/Pilone_4_Body"]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0, 0, 0)
shape = SubResource("BoxShape3D_ds77h")

[node name="LightBeam" type="Node3D" parent="Map/GeneratedStaticBody/Pilone_4"]
script = ExtResource("10_euwd0")

[node name="Pilone_5" type="Node3D" parent="Map/GeneratedStaticBody"]
transform = Transform3D(0.16227208, 0, 0.47293526, 0, 0.5, 0, -0.47293526, 0, 0.16227208, 20, 10, 70)
script = ExtResource("7_n7u81")

[node name="PiloneMesh" type="MeshInstance3D" parent="Map/GeneratedStaticBody/Pilone_5"]
material_override = SubResource("ShaderMaterial_mgd15")
mesh = ExtResource("9_kyype")

[node name="Pilone_5_Body" type="StaticBody3D" parent="Map/GeneratedStaticBody/Pilone_5"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 6.5, 0)
collision_layer = 2
collision_mask = 4

[node name="CollisionShape" type="CollisionShape3D" parent="Map/GeneratedStaticBody/Pilone_5/Pilone_5_Body"]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0, 0, 0)
shape = SubResource("BoxShape3D_rujxr")

[node name="LightBeam" type="Node3D" parent="Map/GeneratedStaticBody/Pilone_5"]
script = ExtResource("10_euwd0")

[node name="Pilone_6" type="Node3D" parent="Map/GeneratedStaticBody"]
transform = Transform3D(0.4672757, 0, 0.17791404, 0, 0.5, 0, -0.17791404, 0, 0.4672757, 40, 30, 10)
script = ExtResource("7_n7u81")

[node name="PiloneMesh" type="MeshInstance3D" parent="Map/GeneratedStaticBody/Pilone_6"]
material_override = SubResource("ShaderMaterial_di5v4")
mesh = ExtResource("9_kyype")

[node name="Pilone_6_Body" type="StaticBody3D" parent="Map/GeneratedStaticBody/Pilone_6"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 6.5, 0)
collision_layer = 2
collision_mask = 4

[node name="CollisionShape" type="CollisionShape3D" parent="Map/GeneratedStaticBody/Pilone_6/Pilone_6_Body"]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0, 0, 0)
shape = SubResource("BoxShape3D_arxee")

[node name="LightBeam" type="Node3D" parent="Map/GeneratedStaticBody/Pilone_6"]
script = ExtResource("10_euwd0")

[node name="Pilone_7" type="Node3D" parent="Map/GeneratedStaticBody"]
transform = Transform3D(0.41786292, 0, 0.27457342, 0, 0.5, 0, -0.27457342, 0, 0.41786292, 60, 10, 50)
script = ExtResource("7_n7u81")

[node name="PiloneMesh" type="MeshInstance3D" parent="Map/GeneratedStaticBody/Pilone_7"]
material_override = SubResource("ShaderMaterial_t65ry")
mesh = ExtResource("9_kyype")

[node name="Pilone_7_Body" type="StaticBody3D" parent="Map/GeneratedStaticBody/Pilone_7"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 6.5, 0)
collision_layer = 2
collision_mask = 4

[node name="CollisionShape" type="CollisionShape3D" parent="Map/GeneratedStaticBody/Pilone_7/Pilone_7_Body"]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0, 0, 0)
shape = SubResource("BoxShape3D_wsll3")

[node name="LightBeam" type="Node3D" parent="Map/GeneratedStaticBody/Pilone_7"]
script = ExtResource("10_euwd0")

[node name="Pilone_8" type="Node3D" parent="Map/GeneratedStaticBody"]
transform = Transform3D(-0.29709056, 0, -0.40216565, 0, 0.5, 0, 0.40216565, 0, -0.29709056, 60, 10, -60)
script = ExtResource("7_n7u81")

[node name="PiloneMesh" type="MeshInstance3D" parent="Map/GeneratedStaticBody/Pilone_8"]
material_override = SubResource("ShaderMaterial_a8smn")
mesh = ExtResource("9_kyype")

[node name="Pilone_8_Body" type="StaticBody3D" parent="Map/GeneratedStaticBody/Pilone_8"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 6.5, 0)
collision_layer = 2
collision_mask = 4

[node name="CollisionShape" type="CollisionShape3D" parent="Map/GeneratedStaticBody/Pilone_8/Pilone_8_Body"]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0, 0, 0)
shape = SubResource("BoxShape3D_qcn36")

[node name="LightBeam" type="Node3D" parent="Map/GeneratedStaticBody/Pilone_8"]
script = ExtResource("10_euwd0")

[node name="Pilone_9" type="Node3D" parent="Map/GeneratedStaticBody"]
transform = Transform3D(0.17281955, 0, 0.46918377, 0, 0.5, 0, -0.46918377, 0, 0.17281955, 50, 10, -60)
script = ExtResource("7_n7u81")

[node name="PiloneMesh" type="MeshInstance3D" parent="Map/GeneratedStaticBody/Pilone_9"]
material_override = SubResource("ShaderMaterial_ni871")
mesh = ExtResource("9_kyype")

[node name="Pilone_9_Body" type="StaticBody3D" parent="Map/GeneratedStaticBody/Pilone_9"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 6.5, 0)
collision_layer = 2
collision_mask = 4

[node name="CollisionShape" type="CollisionShape3D" parent="Map/GeneratedStaticBody/Pilone_9/Pilone_9_Body"]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0, 0, 0)
shape = SubResource("BoxShape3D_8d6gy")

[node name="LightBeam" type="Node3D" parent="Map/GeneratedStaticBody/Pilone_9"]
script = ExtResource("10_euwd0")

[node name="performance" type="Node3D" parent="."]

[node name="Sunset" type="Node3D" parent="."]

[node name="MeshInstance3D" type="MeshInstance3D" parent="Sunset"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -169.3978, 1321.7445)
material_override = SubResource("ShaderMaterial_fgyje")
mesh = SubResource("ArrayMesh_r87ru")
script = ExtResource("12_ds77h")
base_width = 1200.0
top_ratio = 0.5
depth = 2400.0
line_color = Color(0.78941506, 0, 0.33577523, 0.42745098)
line_speed = 0.05
line_width = 0.5
line_spacing = 0.1
emission_strength = 1.5

[node name="MeshInstance3D2" type="MeshInstance3D" parent="Sunset"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.6348572, -245.34164, 3857.736)
mesh = SubResource("SphereMesh_pfvfn")

[node name="PauseMenu" parent="." instance=ExtResource("15_n7u81")]

[node name="Timer" parent="." instance=ExtResource("17_kyype")]
script = ExtResource("18_4s1pf")

[node name="BossHealthUI" parent="." instance=ExtResource("15_euwd0")]
